[agent]
  interval = "5s"
  flush_interval = "5s"

# MQTT Consumer — numeric values only
[[inputs.mqtt_consumer]]
  servers = ["${TELEGRAF_MQTT_BROKER}"]
  topics = [
    "pdu/+/input/voltage",
    "pdu/+/input/frequency",
    "pdu/+/outlet/+/current",
    "pdu/+/outlet/+/power",
    "pdu/+/outlet/+/energy",
    "pdu/+/bank/+/current",
    "pdu/+/bank/+/voltage",
    "pdu/+/bank/+/power",
    "pdu/+/bank/+/apparent_power",
    "pdu/+/bank/+/power_factor",
  ]
  data_format = "value"
  data_type = "float"
  name_override = "pdu"
  qos = 0

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "pdu/+/+/+/+"
    tags = "_/device/type/index/metric"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "pdu/+/+/+"
    tags = "_/device/type/metric"

# MQTT Consumer — string values (state, name, load_state, bridge status)
[[inputs.mqtt_consumer]]
  servers = ["${TELEGRAF_MQTT_BROKER}"]
  topics = [
    "pdu/+/outlet/+/state",
    "pdu/+/outlet/+/name",
    "pdu/+/bank/+/load_state",
    "pdu/+/bridge/status",
  ]
  data_format = "value"
  data_type = "string"
  name_override = "pdu_status"
  qos = 0

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "pdu/+/+/+/+"
    tags = "_/device/type/index/metric"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "pdu/+/+/+"
    tags = "_/device/type/metric"

# Output to InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["${INFLUXDB_URL}"]
  token = "${INFLUXDB_ADMIN_TOKEN}"
  organization = "${INFLUXDB_ORG}"
  bucket = "${INFLUXDB_BUCKET}"
